# 软件架构

在系统内部, 考虑各种因素如业务需求/技术栈/成本/组织架构/可拓展性/可维护性, 选择特定的技术, 将系统划分不同的模块.

`Java web`

## 单体架构

功能/业务集中在一个发布包里面, 跑在一个进程里面.

- 一层架构, `Jsp,ServerLet`, 将业务逻辑, 数据库整合在一起
- MVC的设计模式, 
- dubbo, 前端后端分离, 单体架构

优点

- 易于开发/部署/测试/水平扩展

挑战

- 代码膨胀, 难以维护
- 构建/部署成本大
- 新人上手困难
- 创新困难
- 可扩展性差

## 微服务

使用一套小服务来开发单个应用的方式, 每个服务运行在独立的进程里, 一般采用**轻量级的通讯**机制互联, 并且他们可以通过自动化的方式部署.

特征

- 单一职责
- 轻量级的通讯
- 隔离性
- 有自己的数据
- 技术的多样性

### 架构图

没有最优的架构,只有最适合的

在线教育的网站的部分功能

注册登录, 用户信息, 发邮件, 对课程的CRUD

![](https://pic.fenghong.tech/k8s/weifuwu-01.png)

优势

- 独立性
- 敏捷性
- 技术栈灵活
- 高效团队

劣势

- 额外的工作
- 数据的一致性
- 沟通成本

微服务之间如何通讯?(socket,tcp/ip, http, zk)

|      |  一对一    | 一对多     |
| ---- | ---- | ---- |
|   同步   | 请求响应模式     |   -   |
|   异步   | 通知/请求异步响应     | 发布订阅/发布异步响应     |

通讯协议

- REST API
- RPC

如何选择RPC框架

```cgo
I/O 线程调度模型
序列化方式    json/xml/二进制
多语言支持
服务治理

dubbo
thrift (无服务治理)
moton
grpc protobuf序列化
```
![](https://pic.fenghong.tech/k8s/rpc.png)
- MQ

微服务如何发现彼此?(dubbo,ip:20880)

客户端发现
![](https://pic.fenghong.tech/k8s/client-01.png)

服务端发现
![](https://pic.fenghong.tech/k8s/server-01.png)

服务编排工具

解决服务发现,注册,更新,扩容,部署等.


微服务怎么样部署?更新?扩容?